<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calend√°rio Zelaris</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Neuton:ital,wght@0,200;0,300;0,400;0,700;0,800;1,400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');

    :root {
      --blue: #2f80ed;
      --blue-100: #eaf4ff;
      --border: #d9e6ff;
      --bg: #f6f8fb;
      --card: #ffffff;
      --muted: #6b7280;
      --radius: 12px;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      font-family: "Poppins", sans-serif;
      color: #0f1724;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
      box-sizing: border-box;
    }

    /* TOP LEFT */
    .top-left {
      position: fixed;
      top: 18px;
      left: 18px;
      display: flex;
      gap: 10px;
      z-index: 50;
    }

    .year-select,
    .btn-events {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-events:hover,
    .year-select:hover {
      background: var(--blue-100);
    }

    /* CALENDAR */
    .calendar-wrap {
      width: min(1180px, 96vw);
      height: min(1100px, 90vh);
      background: var(--card);
      border-radius: var(--radius);
      border: 2px solid var(--border);
      box-shadow: 0 10px 30px rgba(15, 23, 36, .06);
      padding: 22px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
    }

    /* BANNER ZELARIS */

    .calendar-header-image {
      width: 100%;
      height: 200px;
      /* ‚Üê controla o tamanho */
      overflow: hidden;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .calendar-header-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* ‚Üê imagem grande sem distorcer */
      user-select: none;
      pointer-events: none;
    }


    /* YEAR */
    .top-year {
      text-align: center;
      font-size: 28px;
      font-weight: 700;
      color: #0b3a66;
    }

    /* MONTH CONTROLS */
    .month-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 18px;
    }

    .nav {
      border: none;
      background: none;
      font-size: 20px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      color: var(--blue);
    }

    .nav:hover {
      background: var(--blue-100);
    }

    .month-label {
      font-size: 20px;
      font-weight: 700;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
    }

    .month-label:hover {
      background: var(--blue-100);
    }

    /* MONTH PICKER */
    .month-picker {
      position: absolute;
      top: 150px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 8px 30px rgba(15, 23, 36, .08);
      display: none;
      z-index: 40;
    }

    .months-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      width: 380px;
    }

    .month-picker button {
      padding: 8px;
      border-radius: 8px;
      border: none;
      background: var(--blue-100);
      cursor: pointer;
      font-weight: 600;
    }

    .month-picker button:hover {
      background: #fff;
      border: 1px solid var(--blue);
      color: var(--blue);
    }

    /* WEEKDAYS (SUNDAY FIRST) */
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: 700;
      color: var(--muted);
    }

    /* DAYS GRID */
    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      flex: 1;
    }

    .day-cell {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: .12s;
    }

    .day-cell:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 18px rgba(15, 23, 36, .06);
      border-color: var(--blue);
    }

    .day-number {
      font-weight: 700;
    }

    .events-list {
      margin-top: 4px;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .events-list div {
      font-weight: 700;
      padding: 0;
      /* sem ‚Äúcaixinha‚Äù */
      border-radius: 0;
      background: none;
      /* üî• remove fundo */
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }


    .day-current {
      outline: 3px solid rgba(47, 128, 237, .15);
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(6, 11, 26, .45);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: .18s;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-card {
      background: #fff;
      border: 2px solid var(--blue);
      border-radius: 12px;
      padding: 18px;
      width: 420px;
    }

    .modal-card h3 {
      margin: 0;
      color: var(--blue);
    }

    .modal-card label {
      display: block;
      margin-top: 8px;
      font-size: 13px;
    }

    .modal-card input,
    .modal-card textarea,
    .modal-card select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 12px;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn.primary {
      background: var(--blue);
      color: #fff;
    }

    .btn.ghost {
      background: #fff;
      border: 1px solid var(--border);
    }
  </style>
</head>

<body>

  <div class="top-left">
    <select id="yearSelect" class="year-select"></select>
    <button id="btnAllEvents" class="btn-events">Eventos</button>
  </div>

  <div class="calendar-wrap">

    <div class="calendar-header-image">
      <img src="img/zelaris3.png" alt="Zelaris">
    </div>

    <div class="top-year" id="topYear"></div>

    <div class="month-controls">
      <button class="nav" id="prev">‚óÄ</button>
      <button class="month-label" id="monthLabel"></button>
      <button class="nav" id="next">‚ñ∂</button>
    </div>

    <div class="month-picker" id="monthPicker">
      <div class="months-grid" id="monthsGrid"></div>
    </div>

    <div class="weekdays">
      <div>Dom</div>
      <div>Seg</div>
      <div>Ter</div>
      <div>Qua</div>
      <div>Qui</div>
      <div>Sex</div>
      <div>S√°b</div>
    </div>

    <div class="days-grid" id="daysGrid"></div>
  </div>

  <div class="modal-backdrop" id="modal">
    <div class="modal-card">
      <h3>Eventos do dia</h3>
      <form id="form">
        <label>T√≠tulo<input id="title"></label>
        <label>Descri√ß√£o<textarea id="desc"></textarea></label>
        <label>Cor<input type="color" id="color" value="#2f80ed"></label>
        <label>Remover<select id="remove">
            <option value="">Nenhum</option>
          </select></label>
        <div class="modal-actions">
          <button type="button" class="btn ghost" id="cancel">Cancelar</button>
          <button class="btn primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
(() => {

  const months = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
  const daysGrid = document.getElementById('daysGrid');
  const yearSelect = document.getElementById('yearSelect');
  const topYear = document.getElementById('topYear');
  const monthLabel = document.getElementById('monthLabel');
  const modal = document.getElementById('modal');
  const form = document.getElementById('form');
  const removeSel = document.getElementById('remove');

  let current = new Date();
  let selectedKey = null;
  let events = {};

  const API = "https://zelaris-calendar-api.emzomell.workers.dev/";

  function key(y,m,d){
    return `${y}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
  }

  async function loadEvents(){
    const r = await fetch(API);
    events = await r.json();
    render();
  }

  function render(){
    const y = current.getFullYear();
    const m = current.getMonth();

    topYear.textContent = y;
    monthLabel.textContent = `${months[m]} ‚Ä¢ ${y}`;
    yearSelect.value = y;
    daysGrid.innerHTML = '';

    const first = new Date(y,m,1).getDay();
    const total = new Date(y,m+1,0).getDate();

    for(let i=0;i<first;i++){
      const b = document.createElement('div');
      b.className = 'day-cell';
      b.style.visibility = 'hidden';
      daysGrid.appendChild(b);
    }

    for(let d=1;d<=total;d++){
      const cell = document.createElement('div');
      cell.className = 'day-cell';

      const num = document.createElement('div');
      num.className = 'day-number';
      num.textContent = d;
      cell.appendChild(num);

      const k = key(y,m+1,d);

      if(events[k]){
        const list = document.createElement('div');
        list.className = 'events-list';
        events[k].forEach(ev=>{
          const e = document.createElement('div');
          e.textContent = ev.title;
          e.style.color = ev.color;
          list.appendChild(e);
        });
        cell.appendChild(list);
      }

      cell.onclick = () => openModal(k);
      daysGrid.appendChild(cell);
    }
  }

  function openModal(k){
    selectedKey = k;
    removeSel.innerHTML = '<option value="">Nenhum</option>';

    (events[k] || []).forEach(ev=>{
      const o = document.createElement('option');
      o.value = ev.id;
      o.textContent = ev.title;
      removeSel.appendChild(o);
    });

    modal.classList.add('show');
  }

  form.onsubmit = async e => {
    e.preventDefault();

    const title = form.title.value.trim();
    const color = form.color.value;
    const id = removeSel.value;

    let payload = null;

    if(id && !title){
      payload = { action:'delete', date:selectedKey, id };
    }
    else if(id && title){
      payload = { action:'edit', date:selectedKey, id, title, color };
    }
    else if(title){
      payload = { action:'create', date:selectedKey, title, color };
    }

    if(payload){
      await fetch(API,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });
    }

    form.reset();
    modal.classList.remove('show');
    await loadEvents();
  };

  document.getElementById('cancel').onclick = () => modal.classList.remove('show');
  document.getElementById('prev').onclick = () => { current.setMonth(current.getMonth()-1); render(); }
  document.getElementById('next').onclick = () => { current.setMonth(current.getMonth()+1); render(); }

  const now = new Date().getFullYear();
  for(let y=now-10;y<=now+10;y++){
    const o = document.createElement('option');
    o.value = y;
    o.textContent = y;
    yearSelect.appendChild(o);
  }
  yearSelect.onchange = () => { current.setFullYear(yearSelect.value); render(); }

  loadEvents();

})();
</script>

</body>

</html>